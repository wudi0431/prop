(function(a){a.fn.datePicker=function(d){var e={selected:null,minimumDate:null,maximumDate:null,dateFormat:null};var b=new Array("一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月");var f=new Array("一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月");var c="td:not(.m):not(:empty)";return this.each(function(){if(this.datePicker){return false}var i=a.extend({},e,d);var l=a(this);var k=null;var g=null;var j=null;var h={initialize:function(){l.click(function(){h.show();return false}).keydown(function(m){if(m.keyCode==13){h.entered();return false}});a(document).keydown(function(m){if(m.keyCode==27){h.hide()}}).click(h.hide);k=h.initializeContainer().hide().append(h.buildMonth(new Date())).delegate(c,"click",h.clicked).delegate("td:not(:empty)","hover",h.hover).delegate(".prev","click",h.loadPrevious).delegate(".next","click",h.loadNext).delegate(".month","click",h.pickMonth).delegate(".year","click",h.pickYear).click(function(){return false})},parseDate:function(m){return new Date(m)},show:function(){k.show()},hide:function(){k.hide()},loadPrevious:function(){k.empty().append(h.buildMonth(new Date(g.getFullYear(),g.getMonth()-1,1)))},loadNext:function(){k.empty().append(h.buildMonth(new Date(g.getFullYear(),g.getMonth()+1,1)))},hover:function(){a(this).toggleClass("hover")},clicked:function(){var n=a(this);if(j=="month"){k.empty().append(h.buildMonth(new Date(g.getFullYear(),(4*(n.parent().index()-1))+n.index(),1)))}else{if(j=="year"){g=new Date(n.text(),0,1);h.pickMonth()}else{k.find("td.selected").removeClass("selected");n.addClass("selected");var m=new Date(g.getFullYear(),g.getMonth(),n.text());l.val(h.format(m)).change();if(i.selected!=null){i.selected()}h.hide()}}},entered:function(){var m=h.parseDate(l.val().replace(/^\s*/,"").replace(/\s*$/,""));if(m==null){return}k.empty().append(h.buildMonth(m)).find(c).eq(m.getDate()-1).click()},initializeContainer:function(){return a("<div>").addClass("calendar").insertAfter(l)},pickYear:function(){j="year";var p=document.createElement("table");var r=g.getFullYear()-6;if(i.minimumDate&&i.minimumDate>r){r=i.minimumDate}for(var o=0;o<3;++o){var q=p.insertRow(-1);for(var n=0;n<4;++n){var m=q.insertCell(-1);m.innerHTML=r+(4*o)+n}}k.empty().append(p)},pickMonth:function(){j="month";var q=document.createElement("table");var s=q.insertRow(-1);var p=s.insertCell(-1);p.colSpan=4;p.className="m year";p.innerHTML=g.getFullYear();for(var o=0;o<3;++o){var r=q.insertRow(-1);for(var n=0;n<4;++n){var m=r.insertCell(-1);m.innerHTML=f[4*o+n]}}k.empty().append(q)},buildMonth:function(o){j="day";var s=new Date(o.getFullYear(),o.getMonth(),1);var w=new Date(o.getFullYear(),o.getMonth()+1,0);g=s;var n=s.getDay();var u=w.getDate();var m=Math.ceil((u+n)/7);var y=document.createElement("table");for(var q=0,t=1;q<m;++q){var z=y.insertRow(-1);for(var p=0;p<7;++p,++t){var v=z.insertCell(-1);if(t>n&&t<=u+n){v.innerHTML=t-n}}}var r=y.insertRow(0);h.addHeaderCell(r,'<div class="prev">&laquo;</div>',1);h.addHeaderCell(r,'<div class="month">'+b[o.getMonth()]+" "+o.getFullYear()+"</div>",5);h.addHeaderCell(r,'<div class="next">&raquo;</div>',1);var x=a(y);if(i.minimumDate&&i.minimumDate>=s){x.find(".prev").hide()}if(i.maximumDate&&i.maximumDate<=w){x.find(".next").hide()}return x},addHeaderCell:function(p,n,o){var m=p.insertCell(-1);m.innerHTML=n;m.className="m ";m.colSpan=o},format:function(p){if(i.dateFormat!=null){var q={"M+":p.getMonth()+1,"d+":p.getDate(),"h+":p.getHours(),"m+":p.getMinutes(),"s+":p.getSeconds(),"q+":Math.floor((p.getMonth()+3)/3),S:p.getMilliseconds()};var m="";if(/(y+)/.test(i.dateFormat)){m=i.dateFormat.replace(RegExp.$1,(p.getFullYear()+"").substr(4-RegExp.$1.length))}for(var n in q){if(new RegExp("("+n+")").test(i.dateFormat)){m=m.replace(RegExp.$1,RegExp.$1.length==1?q[n]:("00"+q[n]).substr((""+q[n]).length))}}return m}else{return b[p.getMonth()]+" "+p.getDate()+" "+p.getFullYear()}}};this.datePicker=h;h.initialize()})}})(jQuery);